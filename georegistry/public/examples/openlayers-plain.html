<!doctype html> 
<html> 
<head> 

<title>GeoRegistry Example: OpenLayers Plain</title> 
<meta name="author" content="Roy Hyunjin Han" /> 
<link rel="shortcut icon" href="/files/favicon.ico"> 
<script src="/files/jquery-1.4.4.min.js" type="text/javascript"></script> 

<link href="/files/openlayers/theme/default/style.css" media="screen" rel="stylesheet" type="text/css" /> 
<link href="/files/openlayers/theme/default/google.css" media="screen" rel="stylesheet" type="text/css" /> 
<script src="/files/openlayers/OpenLayers.js" type="text/javascript"></script> 
<script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script> 

<style> 
    a {text-decoration: none}
    #navigation {position: fixed}
    #toolbar {position: fixed}
    #map {position: fixed}
    .normalFONT {font-family: Helvetica, Arial, sans-serif}
    .linkOFF {color: darkblue; background-color: white} 
    .linkON {color: white; background-color: darkblue}
    .olLayerGoogleCopyright {display: none}
</style> 

<script> 
var map, layer;

$(document).ready(function() {

    // Prepare page
    $('a').hover(
        function () {this.className = this.className.replace('OFF', 'ON');}, 
        function () {this.className = this.className.replace('ON', 'OFF');}
    );
    function getNumber(x) {return /\d+/.exec(x)[0]}
    function getID(obj) {return getNumber(obj.id)}
    
    // Make map using OpenLayers
    map = new OpenLayers.Map('map', {
        projection: new OpenLayers.Projection("EPSG:3857")
    });
    map.addControl(new OpenLayers.Control.LayerSwitcher());
    map.addLayers([
        new OpenLayers.Layer.Google("Google Physical", {type: google.maps.MapTypeId.TERRAIN}),
        new OpenLayers.Layer.Google("Google Streets", {numZoomLevels: 20}),
        new OpenLayers.Layer.Google("Google Hybrid", {type: google.maps.MapTypeId.HYBRID, numZoomLevels: 20}),
        new OpenLayers.Layer.Google("Google Satellite", {type: google.maps.MapTypeId.SATELLITE, numZoomLevels: 22})
    ]);
    map.setCenter((new OpenLayers.LonLat(-74.0059731, 40.7143528)).transform(new OpenLayers.Projection('EPSG:4326'), map.getProjectionObject()), 0);
    
    // Define functions
    function updateMaps() {
        // Load parameters
        var tagText = $.trim($('#tagText').val() || "");
        if (!tagText) return;
    
        // Update OpenLayers
        if (layer) {
            map.removeLayer(layer);
            layer.destroy();
        }
        layer = new OpenLayers.Layer.Vector('Features', {
            projection: new OpenLayers.Projection('EPSG:4326'),
            strategies: [new OpenLayers.Strategy.BBOX()],
            protocol: new OpenLayers.Protocol.HTTP({
                url: "/maps.json",
                params: {
                    srid: 4326,
                    tags: tagText,
                    bboxFormat: 'yxyx',
                    simplified: 1
                },
                format: new OpenLayers.Format.GeoJSON()
            }),
            styleMap: new OpenLayers.StyleMap({
                fillColor: 'yellow',
                fillOpacity: 0.1,
                strokeColor: 'yellow',
                strokeWidth: 2,
                pointRadius: 5
            })
        });
        map.addLayer(layer);
        layer.refresh();
    }
    // Define controls
    // $('#tagText').change(updateMaps);
    // Prepare page
    // updateMaps();

});
</script> 
</head> 
<body class=normalFONT> 

<div id=navigation>
<a class=linkOFF href="/docs">See documentation</a>
<a class=linkOFF href="/people/register">Get an API key</a>
</div> 

<div id=toolbar>
<select class=normalFONT multiple=multiple id=tagTexts>
</select>
</div> 

<div id=map>
</div> 

</body> 
</html>
